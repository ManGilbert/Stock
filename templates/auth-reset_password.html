{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Null</title>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'assets/vendors/bootstrap-icons/bootstrap-icons.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/app.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/pages/auth.css' %}">
    <link rel="stylesheet" href="{% static 'assets/vendors/toastify/toastify.css' %}">
</head>

<body>
    <div id="auth">
        <div class="row h-100">
            <div class="col-lg-5 col-12">
                <div id="auth-left">
                    <a class="auth-title" href="{% url 'index' %}">
                        <h6 class="auth-title">StockSale</h6>
                    </a>
                    <div class="text mt-5 text-lg fs-4">
                        <p>Reset Password, Enter your new password below.</p>
                    </div>

                    <form method="POST">
                        {% csrf_token %}

                        <input type="text" name="otp" class="form-control form-control-xl mb-3" placeholder="Enter OTP"
                            required>

                        <div class="text-center mb-3">
                            <button type="button" id="resendBtn" class="btn btn-outline-secondary btn-sm" disabled>
                                Resend OTP (<span id="timer">60</span>s)
                            </button>
                        </div>

                        <input type="password" name="password" class="form-control form-control-xl mb-2"
                            placeholder="New Password" required>

                        <small id="passwordHelp"></small>

                        <input type="password" name="confirm" class="form-control form-control-xl mt-3 mb-3"
                            placeholder="Confirm Password" required>

                        <button class="btn btn-primary btn-lg w-100">
                            Reset Password
                        </button>
                    </form>

                    <script>
                        let timeLeft = 60;
                        const resendBtn = document.getElementById("resendBtn");
                        const timer = document.getElementById("timer");

                        const interval = setInterval(() => {
                            timeLeft--;
                            timer.textContent = timeLeft;

                            if (timeLeft <= 0) {
                                clearInterval(interval);
                                resendBtn.disabled = false;
                                resendBtn.textContent = "Resend OTP";
                            }
                        }, 1000);

                        resendBtn.onclick = () => {
                            resendBtn.disabled = true;
                            fetch("{% url 'resend-otp' %}");
                        };
                    </script>

                    <script>
                        const passwordInput = document.querySelector("input[name='password']");
                        const help = document.getElementById("passwordHelp");

                        passwordInput.addEventListener("input", () => {
                            const val = passwordInput.value;
                            const strong =
                                val.length >= 8 &&
                                /[A-Z]/.test(val) &&
                                /[a-z]/.test(val) &&
                                /\d/.test(val) &&
                                /[!@#$%^&*]/.test(val);

                            help.textContent = strong
                                ? "Strong password âœ…"
                                : "8+ chars, uppercase, lowercase, number & symbol";
                            help.style.color = strong ? "green" : "red";
                        });
                    </script>
                    
                </div>
            </div>

            <div class="col-lg-7 d-none d-lg-block">
                <div id="auth-right"></div>
            </div>
        </div>
    </div>

    <script src="{% static 'assets/vendors/toastify/toastify.js' %}"></script>

    {% if messages %}
    {% for message in messages %}
    <script>
        Toastify({
            text: "{{ message }}",
            duration: 3000,
            close: true,
            gravity: "top",
            position: "right",
            backgroundColor:
                "{% if message.tags == 'success' %}#28a745{% else %}#dc3545{% endif %}",
            stopOnFocus: true
        }).showToast();
    </script>
    {% endfor %}
    {% endif %}
</body>

</html>