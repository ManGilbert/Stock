{% extends "base.html" %}
{% block title %}Create User{% endblock %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-steps/1.1.0/jquery.steps.min.css">

<style>
    .wizard>.content {
        min-height: 340px;
    }

    .form-label {
        font-weight: 600;
    }

    .step-help {
        font-size: 0.9rem;
    }
</style>

<div class="card my-4">
    <div class="card-header">
        <h5 class="card-title">Create Account & Manager</h5>
        <p class="text-muted mb-0">
            Follow steps to create account, manager, and branch.
        </p>
    </div>

    <div class="card-body">
        <form id="example-form" method="POST" action="{% url 'create_user_account' %}">
            {% csrf_token %}
            <div>

                <!-- STEP 1 -->
                <h6>Account</h6>
                <section>
                    <p class="step-help text-muted mb-3">Create the main account.</p>

                    <div class="mb-3">
                        <label class="form-label">Account Name *</label>
                        <input type="text" name="account_name" class="form-control required">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Phone *</label>
                        <input type="text" name="account_phone" class="form-control required">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Address *</label>
                        <input type="text" name="account_address" class="form-control required">
                    </div>
                </section>

                <!-- STEP 2 -->
                <h6>Manager</h6>
                <section>
                    <p class="step-help text-muted mb-3">Create account manager.</p>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">First Name *</label>
                            <input type="text" name="first_name" class="form-control required">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Last Name *</label>
                            <input type="text" name="last_name" class="form-control required">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email *</label>
                            <input type="email" name="email" class="form-control required email">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Password *</label>
                            <input type="password" id="password" name="password" class="form-control required">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Confirm Password *</label>
                            <input type="password" name="confirm_password" class="form-control required">
                        </div>
                    </div>
                </section>

                <!-- STEP 3 -->
                <h6>Branch</h6>
                <section>
                    <p class="step-help text-muted mb-3">
                        Create branch and assign manager.
                    </p>

                    <div class="mb-3">
                        <label class="form-label">Branch Name *</label>
                        <input type="text" name="branch_name" class="form-control required">
                    </div>
                </section>

                <!-- STEP 4 -->
                <h6>Finish</h6>
                <section>
                    <p class="text-muted">Confirm creation.</p>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="agree" id="agree">
                        <label class="form-check-label" for="agree">
                            I confirm the information is correct
                        </label>
                    </div>
                </section>

            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-steps/1.1.0/jquery.steps.min.js"></script>

<script>
    $(function () {
        var form = $("#example-form");

        form.validate({
            errorClass: "text-danger",
            errorPlacement: function (error, element) {
                if (element.attr("name") === "agree") {
                    error.insertAfter(element.closest(".form-check"));
                } else {
                    error.insertAfter(element);
                }
            },
            rules: {
                confirm_password: {
                    equalTo: "#password"
                },
                agree: {
                    required: true
                }
            },
            messages: {
                agree: "You must confirm before creating the account"
            }
        });

        $("#example-form > div").steps({
            headerTag: "h6",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            autoFocus: true,
            labels: {
                finish: "Create Account"
            },
            onStepChanging: function (event, currentIndex, newIndex) {
                if (currentIndex > newIndex) return true;
                form.validate().settings.ignore = ":hidden";
                return form.valid();
            },
            onFinished: function () {
                $(".actions a").addClass("disabled");
                form.submit();
            }
        });
    });
</script>

{% endblock %}